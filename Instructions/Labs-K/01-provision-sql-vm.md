
## 실습 1 - Azure Virtual Machine에 SQL Server 프로비저닝

**모듈:** 데이터 플랫폼 리소스 계획 및 구현

**실습 목표:** Azure Virtual Machine에 SQL Server 프로비저닝

**예상 소요 시간:** 30분

**시나리오:**

본 실습에서는 Azure Portal을 탐색하고 이를 사용하여 SQL Server 2022가 설치된 Azure VM(가상 머신)을 생성합니다. 그런 다음 원격 데스크톱 프로토콜(RDP)을 통해 가상 머신에 연결합니다.

AdventureWorks 회사의 데이터베이스 관리자로서, 개념 증명(Proof of Concept)에 사용할 테스트 환경을 구축해야 합니다. 이 개념 증명은 Azure 가상 머신에 설치된 SQL Server와 AdventureWorksDW 데이터베이스의 백업을 활용합니다. 따라서 가상 머신을 설정하고, 데이터베이스를 복원한 후, 쿼리를 실행하여 데이터베이스가 정상적으로 사용 가능한지 확인해야 합니다.

---

**1단계: Azure Virtual Machine에 SQL Server 배포**

1.  랩 가상 머신(또는 로컬 컴퓨터)에서 웹 브라우저를 열고 [https://portal.azure.com](https://portal.azure.com)으로 이동합니다. Azure 구독과 연결된 Microsoft 계정을 사용하여 로그인합니다.

2.  포털 상단의 검색 창을 찾습니다. **Azure SQL**을 검색합니다. 서비스 목록에 나타나는 **Azure SQL** 결과를 선택합니다.

3.  **Azure SQL** 페이지(블레이드)에서 **+ 만들기** 버튼을 클릭합니다.

4.  **SQL 배포 옵션 선택** 페이지에서 **SQL 가상 머신** 항목 아래의 드롭다운 메뉴를 클릭합니다. **무료 SQL Server 라이선스: Windows Server 2022 기반 SQL Server 2022 Developer** 옵션을 선택합니다. 그 후 **만들기** 버튼을 클릭합니다.

5.  **가상 머신 만들기** 페이지에서 다음 정보를 입력하고, 나머지 옵션은 기본값으로 유지합니다.

    *   **구독:** `<사용자의 구독 선택>`
    *   **리소스 그룹:** `<사용할 리소스 그룹 선택 또는 새로 만들기>`
    *   **가상 머신 이름:** `AzureSQLServerVM` (또는 원하는 다른 이름)
    *   **지역:** `<사용자의 리소스 그룹과 동일한 지역 또는 가까운 지역 선택>`
    *   **가용성 옵션:** `인프라 중복 필요 없음` (특별한 요구 사항이 없다면)
    *   **이미지:** `무료 SQL Server 라이선스: Windows Server 2022 기반 SQL Server 2022 Developer - Gen2` (기본 선택 확인)
    *   **Azure 스팟 할인으로 실행:** `아니요` (체크 해제)
    *   **크기:** `Standard_D2s_v5` (2 vCPU, 8GiB 메모리). 이 옵션이 보이지 않으면 "모든 크기 보기" 링크를 클릭하여 선택합니다.
    *   **관리자 계정 사용자 이름:** `<VM에 로그인할 관리자 사용자 이름 입력>`
    *   **관리자 계정 암호:** `<강력한 암호 입력 및 확인>`
    *   **인바운드 포트 규칙:**
        *   **공용 인바운드 포트:** `선택한 포트 허용`
        *   **인바운드 포트 선택:** `RDP (3389)`
    *   **기존 Windows Server 라이선스를 사용하시겠습니까?:** `아니요` (체크 해제)

    📝 **중요:** 여기서 설정한 관리자 사용자 이름과 암호를 꼭 메모해 두십시오. VM에 연결할 때 필요합니다.

6.  상단의 **디스크** 탭으로 이동하여 디스크 구성을 검토합니다. (기본값 유지)

7.  **네트워킹** 탭으로 이동하여 네트워크 설정을 검토합니다. (기본값 유지)

8.  **관리** 탭으로 이동하여 관리 옵션을 검토합니다.

9.  **자동 종료 사용** 옵션이 **체크 해제**되어 있는지 확인합니다. (필요시 설정 가능)

10. **고급** 탭으로 이동하여 설정을 검토합니다. (기본값 유지)

11. **SQL Server 설정** 탭으로 이동하여 SQL Server 관련 구성을 검토합니다.

    📝 이 화면에서 SQL Server 데이터 파일, 로그 파일, TempDB 파일의 스토리지 구성을 변경할 수 있습니다. 기본적으로 Azure VM 템플릿은 데이터용 프리미엄 디스크(읽기 캐시 사용), 트랜잭션 로그용 프리미엄 디스크(캐시 없음), TempDB용 로컬 임시 SSD(Windows의 D:\ 드라이브)를 구성합니다.

12. 페이지 하단의 **검토 + 만들기** 버튼을 클릭합니다. 유효성 검사가 통과되면 **만들기** 버튼을 클릭하여 VM 배포를 시작합니다.

13. 배포가 진행되는 것을 확인합니다. VM 배포에는 약 5분에서 10분 정도 소요될 수 있습니다. 배포가 완료되면 **리소스로 이동** 버튼을 클릭합니다.

    📝 배포가 완료될 때까지 잠시 기다려 주세요.

14. 생성된 가상 머신의 **개요** 페이지에서 VM의 상태와 기본 정보를 확인하고, 왼쪽 메뉴를 통해 다양한 관리 옵션을 탐색해 보세요.

---

**2단계: Azure Virtual Machine의 SQL Server에 연결**

1.  가상 머신의 **개요** 페이지 상단 메뉴에서 **연결** 드롭다운을 클릭하고 **RDP**를 선택합니다. (또는 **연결** > **연결** 클릭)

2.  **RDP** 탭(또는 연결 창)에서 **RDP 파일 다운로드** 버튼을 클릭합니다.

    📝 만약 "포트 필수 조건이 충족되지 않았습니다."와 같은 오류가 표시되면, 해당 메시지의 링크를 클릭하여 RDP(3389) 포트에 대한 인바운드 네트워크 보안 그룹(NSG) 규칙을 추가해야 합니다. (일반적으로 VM 생성 시 RDP 포트를 허용했다면 이 단계는 필요 없습니다.)

3.  다운로드된 `.rdp` 파일을 엽니다. 원격 데스크톱 연결 프로그램이 실행됩니다. "이 게시자를 신뢰하나요?" 또는 유사한 보안 경고가 나타나면 **연결** 버튼을 클릭합니다.

4.  자격 증명을 묻는 창이 나타나면, VM 생성 시 설정했던 **관리자 사용자 이름**과 **암호**를 입력합니다. **확인** 버튼을 클릭합니다.

5.  인증서 관련 경고 창이 나타나면 **예** 버튼을 클릭하여 연결을 계속 진행합니다.

6.  가상 머신의 Windows 데스크톱 환경에 성공적으로 연결되면, 작업 표시줄의 검색 아이콘(돋보기 모양)을 클릭하고 `SSMS`를 입력합니다. 검색 결과에서 **Microsoft SQL Server Management Studio**를 선택하여 실행합니다.

7.  SSMS가 실행되면 **서버에 연결** 대화 상자가 자동으로 나타납니다. 서버 이름은 보통 가상 머신 이름으로 미리 채워져 있습니다. **인증** 방식이 'Windows 인증'으로 되어 있는지 확인합니다. (SQL 인증을 설정했다면 해당 방식으로 변경) 추가 옵션에서 **서버 인증서 신뢰(Trust server certificate)** 옵션을 **체크**한 후 **연결** 버튼을 클릭합니다.

8.  SQL Server 인스턴스에 성공적으로 연결되면 개체 탐색기에 서버 정보가 표시됩니다. 확인 후 SSMS 창 오른쪽 상단의 **X** 버튼을 클릭하여 SSMS를 닫습니다.

9.  원격 데스크톱 연결 창 상단의 연결 표시줄에 있는 **X** 버튼을 클릭하거나, 시작 메뉴에서 로그아웃하여 RDP 세션을 종료합니다.

---

**정리 단계: 리소스 정리**

이 가상 머신을 더 이상 사용하지 않을 경우, 불필요한 비용 발생을 막기 위해 생성된 리소스를 삭제하는 것이 좋습니다.

**실습 리소스 개별 삭제**

기존 리소스 그룹을 사용했고 다른 리소스는 유지해야 한다면, 이 실습에서 생성한 리소스만 선택하여 삭제할 수 있습니다.

1.  Azure Portal에서 사용한 **리소스 그룹**으로 이동합니다.
2.  리소스 목록에서 이 실습에서 생성한 리소스들을 찾습니다. 일반적으로 VM 이름(`AzureSQLServerVM`)으로 시작하는 리소스들(VM, 디스크, 네트워크 인터페이스, 공용 IP 주소, 네트워크 보안 그룹 등)입니다. 해당 리소스들을 모두 **체크**합니다.
3.  상단 메뉴에서 **삭제** 버튼을 클릭합니다.
4.  삭제 확인 창에서 `예` 또는 `삭제`를 입력하라는 메시지가 나타나면 그대로 입력하고 **삭제** 버튼을 클릭합니다.
5.  선택한 리소스들이 삭제될 때까지 기다립니다.
6.  Azure Portal을 닫습니다.

---

이것으로 실습을 성공적으로 완료했습니다.
